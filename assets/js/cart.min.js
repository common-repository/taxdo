jQuery(document).ready(function(e){function t(){e.unblockUI()}e(document).on("click","#taxdo_remove_cert_code",function(t){t.preventDefault(),console.log("#taxdo_remove_cert_code");let c={action:"taxdo_remove_certificate",security:cart_object.nonce};e.post(cart_object.ajax_url,c,function(t){if(t.success){let c=e("[name='update_cart']");c.prop("disabled",!1),c.removeAttr("disabled"),c.trigger("click")}})});let c=e("#taxdo_upload_certificate_form");e(document).on("click","#taxdo_apply_cert_code",function(t){t.preventDefault();let o={action:"taxdo_apply_certificate",security:cart_object.nonce,taxdo_cert_code:e("#taxdo_cert_code").val()};e.post(cart_object.ajax_url,o,function(t){if(t.success){let o=e("[name='update_cart']");o.prop("disabled",!1),o.removeAttr("disabled"),o.trigger("click"),c.toggle()}let n=e(".woocommerce-notices-wrapper");n.empty(),n.append(t.data),n.get(0).scrollIntoView()})});let o=e("#taxdo_upload_tax_cert");function n(){e(document.body).trigger("update_checkout")}c.length&&(o.length&&e(document).on("click","#taxdo_upload_tax_cert",function(e){e.preventDefault(),c.toggle()}),c.on("submit",function(o){o.preventDefault();let n=new FormData,a=e(o.target).find("#attachment")[0].files[0];n.append("attachment",a),n.append("action","taxdo_upload_tax_cert"),n.append("security",cart_object.nonce);let i=e(o.target).serializeArray();for(let r=0;r<i.length;r++)n.append(i[r].name,i[r].value);e.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({url:"/wp-json/taxdo/v1/certificate-request",data:n,processData:!1,contentType:!1,type:"POST",success:function(t){t.reference&&c.toggle();let o=e(".woocommerce-notices-wrapper");o.empty();let n=`<div class="wc-block-components-notice-banner is-success" role="alert"><div class="wc-block-components-notice-banner__content">Your Sales Tax Certificate  is received (Ref ${t.reference}). Our team is reviewing it, and you'll get a confirmation email with an exemption code, if the certificate meets all the requirements.</div></div>`;o.append(n),o.get(0).scrollIntoView()},always:function(){t()},error:function(t){let c=e(".woocommerce-notices-wrapper");c.empty();let o=`<div class="wc-block-components-notice-banner is-error" role="alert"><div class="wc-block-components-notice-banner__content">${t.responseJSON.message}</div></div>`;c.append(o),c.get(0).scrollIntoView()},complete:function(){t()}})})),e("#country").select2({width:"100%"}),e("#state").select2({width:"100%"}),e("[id^=sub_tax_taxDo_]").on("change",n),e(document.body).on("updated_checkout",function(){e("[id^=sub_tax_taxDo_]").on("change",n),e("select[id^=sub_tax_taxDo_]").each(function(){e(this).select2({width:"100%",minimumResultsForSearch:"Infinity"})})})});
